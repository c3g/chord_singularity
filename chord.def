Bootstrap: docker
From: python:3.7-slim-stretch

%files
    . /chord

%post
    apt update && apt install -y nginx git gcc
    export HOME="/chord"
    mkdir -p /chord/data
    mkdir -p /chord/tmp/nginx
    mkdir /chord/services
    mkdir /chord/vassals
    rm /var/log/nginx/*.log
    touch /chord/tmp/nginx/access.log
    touch /chord/tmp/nginx/error.log
    ln -s /chord/tmp/nginx/access.log /var/log/nginx/access.log
    ln -s /chord/tmp/nginx/error.log /var/log/nginx/error.log
    pip install --no-cache-dir virtualenv
    pip install --no-cache-dir -r /chord/requirements.txt
    cd /chord
    python3 ./container_setup.py ./chord_services.json
    apt purge -y git gcc
    apt autoremove -y

%startscript
    exec bash /chord/start_script.bash

%labels
    Author David Lougheed
